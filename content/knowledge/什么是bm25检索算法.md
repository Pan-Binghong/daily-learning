---
title: ä»€ä¹ˆæ˜¯BM25æ£€ç´¢ç®—æ³•
date: '2024-12-02T10:52:00.000Z'
lastmod: '2024-12-02T11:31:00.000Z'
draft: false
æ ‡ç­¾:
- Retriever
categories:
- çŸ¥è¯†
---

> ðŸ’¡ RAGä¸­å…³äºŽæ£€ç´¢(Retriever)ç®—æ³•ï¼ŒBM25(Best Matching 25)è¯¦ç»†äº†è§£ä¸€ä¸‹ã€‚

å®ƒæ˜¯ä¸€ç§ç»å…¸çš„ä¿¡æ¯æ£€ç´¢ç®—æ³•ï¼Œæ˜¯åŸºäºŽOkapi TF-IDFç®—æ³•çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œæ—¨åœ¨è§£å†³Okapi TF-IDFç®—æ³•çš„ä¸€äº›ä¸è¶³ä¹‹å¤„ã€‚å…¶è¢«å¹¿æ³›åº”ç”¨äºŽä¿¡æ¯æ£€ç´¢é¢†åŸŸçš„æŽ’åå‡½æ•°ï¼Œç”¨äºŽä¼°è®¡æ–‡æ¡£Dä¸Žç”¨æˆ·æŸ¥è¯¢Qä¹‹é—´çš„ç›¸å…³æ€§ã€‚å®ƒæ˜¯ä¸€ç§åŸºäºŽæ¦‚çŽ‡æ£€ç´¢æ¡†æž¶çš„æ”¹è¿›ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†é•¿æ–‡æ¡£å’ŒçŸ­æŸ¥è¯¢æ—¶è¡¨çŽ°å‡ºè‰²ã€‚BM25çš„æ ¸å¿ƒæ€æƒ³æ˜¯åŸºäºŽè¯é¢‘(TF)å’Œé€†æ–‡æ¡£é¢‘çŽ‡(IDF)æ¥,åŒæ—¶è¿˜å¼•å…¥äº†æ–‡æ¡£çš„é•¿åº¦ä¿¡æ¯æ¥è®¡ç®—æ–‡æ¡£Då’ŒæŸ¥è¯¢Qä¹‹é—´çš„ç›¸å…³æ€§ã€‚ç›®å‰è¢«å¹¿æ³›è¿ç”¨çš„æœç´¢å¼•æ“ŽESå°±å†…ç½®äº†BM25ç®—æ³•è¿›è¡Œå…¨æ–‡æ£€ç´¢ã€‚

---

## Pythonä»£ç å®žçŽ°

```powershell
import math
import jieba
from collections import Counter

class BM25:
    def __init__(self, k1=1.5, b=0.75):
        self.k1 = k1  # è¯é¢‘é¥±å’Œå‚æ•°
        self.b = b    # æ–‡æ¡£é•¿åº¦å½’ä¸€åŒ–å‚æ•°
        self.corpus = []
        self.doc_lengths = []
        self.avgdl = 0
        self.doc_freqs = {}
        self.idf = {}
        self.doc_len = 0
        
    def fit(self, corpus):
        """è®­ç»ƒBM25æ¨¡åž‹"""
        self.corpus = []
        # å¯¹æ¯ä¸ªæ–‡æ¡£è¿›è¡Œåˆ†è¯
        for document in corpus:
            words = list(jieba.cut(document))
            self.corpus.append(words)
            self.doc_lengths.append(len(words))
            
        self.doc_len = len(self.corpus)
        self.avgdl = sum(self.doc_lengths) / self.doc_len
        
        # è®¡ç®—è¯é¢‘å’Œé€†æ–‡æ¡£é¢‘çŽ‡
        for document in self.corpus:
            frequencies = Counter(document)
            for word, freq in frequencies.items():
                if word not in self.doc_freqs:
                    self.doc_freqs[word] = 0
                self.doc_freqs[word] += 1
        
        # è®¡ç®—IDFå€¼
        for word, freq in self.doc_freqs.items():
            self.idf[word] = math.log(1 + (self.doc_len - freq + 0.5)/(freq + 0.5))
    
    def get_scores(self, query):
        """è®¡ç®—æŸ¥è¯¢ä¸Žæ‰€æœ‰æ–‡æ¡£çš„BM25å¾—åˆ†"""
        query_words = list(jieba.cut(query))
        scores = [0] * self.doc_len
        
        for word in query_words:
            if word not in self.doc_freqs:
                continue
                
            for idx, doc in enumerate(self.corpus):
                freq = Counter(doc)[word]
                numerator = self.idf[word] * freq * (self.k1 + 1)
                denominator = freq + self.k1 * (1 - self.b + self.b * self.doc_lengths[idx] / self.avgdl)
                scores[idx] += numerator / denominator
                
        return scores

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # ç¤ºä¾‹æ–‡æ¡£é›†åˆ
    documents = [
        "æˆ‘å–œæ¬¢åƒè‹¹æžœå’Œé¦™è•‰",
        "é¦™è•‰æ˜¯ä¸€ç§æ°´æžœ",
        "è‹¹æžœæ‰‹æœºå¾ˆå—æ¬¢è¿Ž",
        "æ°´æžœå¯¹å¥åº·æœ‰å¥½å¤„",
        "æˆ‘æœ€å–œæ¬¢çš„æ°´æžœæ˜¯è‹¹æžœ"
    ]
    
    # åˆå§‹åŒ–BM25æ£€ç´¢å™¨
    bm25 = BM25()
    # è®­ç»ƒæ¨¡åž‹
    bm25.fit(documents)
    
    # æµ‹è¯•æŸ¥è¯¢
    query = "è‹¹æžœæ°´æžœ"
    scores = bm25.get_scores(query)
    
    # æ‰“å°æ¯ä¸ªæ–‡æ¡£çš„å¾—åˆ†
    print("æŸ¥è¯¢è¯­å¥:", query)
    print("\nç›¸å…³æ€§å¾—åˆ†:")
    for doc_id, score in enumerate(scores):
        print(f"æ–‡æ¡£ {doc_id + 1}: {documents[doc_id]}")
        print(f"BM25å¾—åˆ†: {score:.4f}")

```

- ç»“æžœ
---

> References



