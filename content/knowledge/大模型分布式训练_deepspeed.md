---
title: å¤§æ¨¡åž‹åˆ†å¸ƒå¼è®­ç»ƒ_DeepSpeed
date: '2025-01-07T01:29:00.000Z'
lastmod: '2025-04-28T07:10:00.000Z'
draft: false
tags:
- Knowledge
categories:
- çŸ¥è¯†
---

> ðŸ’¡ è®°å½•å­¦ä¹ DeepSpeedå…¨è¿‡ç¨‹ã€‚å«åŽŸç†ï¼Œä»£ç ã€‚

## ç®€ä»‹|SummaryÂ 

DeepSpeedæ˜¯Microsoft(å¾®è½¯)å¼€å‘çš„å¼€æºæ·±åº¦å­¦ä¹ ä¼˜åŒ–åº“, çš†åœ¨æé«˜å¤§è§„æ¨¡æ¨¡åž‹è®­ç»ƒçš„æ•ˆçŽ‡å’Œå¯æ‹“å±•æ€§ã€‚é€šè¿‡å¤šç§æ–¹å¼åŠ é€Ÿæ¨¡åž‹è®­ç»ƒ, æ–¹æ³•æœ‰: æ¨¡åž‹å¹¶è¡ŒåŒ–ã€æ¢¯åº¦ç´¯åŠ ã€åŠ¨æ€ç²¾åº¦ç¼©æ”¾ã€æœ¬åœ°æ¨¡åž‹æ··åˆç²¾åº¦ç­‰ã€‚

DeepSpeedä½œä¸ºå¤§æ¨¡åž‹è®­ç»ƒåŠ é€Ÿåº“, ä½äºŽæ¨¡åž‹è®­ç»ƒæ¡†æž¶å’Œæ¨¡åž‹ä¹‹é—´, ç”¨æ¥æå‡è®­ç»ƒã€æŽ¨ç†ç­‰ã€‚

---

## æ ¸å¿ƒæŠ€æœ¯|Technology

### ZeRO(é›¶å†—ä½™ä¼˜åŒ–å™¨)

> ZeROå¯ä»¥è®¤ä¸ºæ˜¯æ•°æ®å¹¶è¡Œ, ä½†æ˜¯ç”¨åˆ°äº†æ¨¡åž‹å¹¶è¡Œçš„æ€æƒ³ã€‚

ZeROæ˜¯ä¸€ç§ç”¨äºŽå¤§è§„æ¨¡åˆ†å¸ƒå¼æ·±åº¦å­¦ä¹ çš„æ–°åž‹å†…å­˜ä¼˜åŒ–æŠ€æœ¯ã€‚ä¸»è¦æé«˜è®­ç»ƒæ—¶çš„æ˜¾å­˜æ•ˆçŽ‡å’Œè®¡ç®—æ•ˆçŽ‡ã€‚ZeROé€šè¿‡åœ¨æ•°æ®å¹¶è¡Œè¿›ç¨‹ä¹‹é—´åˆ’åˆ†æ¨¡åž‹çŠ¶æ€å‚æ•°ã€æ¢¯åº¦å’Œä¼˜åŒ–å™¨çŠ¶æ€æ¥æ¶ˆé™¤æ•°æ®å¹¶è¡Œè¿›ç¨‹ä¸­çš„å†…å­˜å†—ä½™, å¹¶ä¸æ˜¯å¤åˆ¶å®ƒä»¬ã€‚åœ¨è®­ç»ƒæœŸé—´ä½¿ç”¨åŠ¨æ€é€šä¿¡è°ƒåº¦æ¥åœ¨åˆ†å¸ƒå¼è®¾å¤‡ä¹‹é—´å…±äº«å¿…è¦çš„çŠ¶æ€, ä»¥ä¿æŒæ•°æ®å¹¶è¡Œçš„è®¡ç®—ç²’åº¦å’Œé€šä¿¡é‡ã€‚

### ZeROçš„ä¸‰ä¸ªé˜¶æ®µä»¥åŠå¯¹åº”åŠŸèƒ½

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/fc187c04-cf34-444f-b5f2-bdcdfad76660/037b7e03-6ddd-482d-bf08-6f0aaf7c57da/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4663STUN7WC%2F20251230%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251230T025754Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEOL%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDHDJLl5uoKcsUW6XzMy2xRnTOwr%2Fbm102yHLRj07xpFQIgF%2FOqN7lS4G65W7XQh%2BSIYhLZkK4Cg1dwjQsrHOZb5PEqiAQIq%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDHXiKsrZPPs7drxsOyrcA1W%2BmBMfIr8xTQ1LaTHvE59NkO0%2FG3DWugpd2f7Eowkv9yM239jkLg8UC4O4JtDNgfL8mh1g%2FeVye5PBVGvXhNr%2FkTAY9XwZlDNqio70xVptIy3Yj%2BA3Su5cA3O%2BUMEegmmp2iSInXGAtjCOuMTl0Fm3pnmsUls2%2BYzgpLnoMUKvwffFZM%2BX%2BF9tugC5r7oCRP4qk1dNrRcfzPHA%2BP0pt21IzLIBq8BhF%2BND5qa1MPgoNokA2DlOrE0SMwtVaA3asmH0Sr8M6LHGzebIg8kobvNyFHv%2BnBZNH993ceCFjfY1L8bJOvqqyEe2a5ENAQWvdpQiOIn6dAdmWwPFvhJ5md9cDuQtj4sv3h5u7rxhtkEt8ORDLl49WDi2KrfKuIC7AldJUD5%2F%2FVv9gloLMEUmnWhQ7%2Fq0uOvBxtqaJd%2FAcSHlV6OB7WaZT3Z4nxVpmIZp%2FsAtkToXt1IjnDIUfxrzSKqraN7hgwhViaHZCrbwjNsRf9qoeig8nfjXhn62mHOnh6meVjzPHSnU7iYXcdfIfI0iUgEieW4Wtc4GZNz8wGwlchzCCvQLTegdimUTuiMJoDphXA2qjdeNH3wPYBznB5MejNTzrddUBH2Y041nTQVuxU5lrRKP7cc4JIP6MO%2FYzMoGOqUBr9O3FWgk34HG7cTZwswdS3nS%2BXHZFk7mGpmbKQdOOkVT5PaIfvFb9CHMKNO%2FwN%2B6Izp1AK0rExXo9RSm1tzeTzY%2B5yyFfriQU6ESGCRO0ckZQrvYzKKp0DGjsWPsNhYRYdE2kgN1YU7lZZ5Hw89HzSoVSlOkP6rKFKjygJVUtIch64yOxAvYIbPGsrnIO5uGLJ0%2FVk052gZ6P5X8vhmVQHRkP%2Fbd&X-Amz-Signature=75261be0374d440a1b301b4575f3c564dfef2eb8acf1e2a38af25ee5041b1192&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

1. ä¼˜åŒ–å™¨çŠ¶æ€åˆ†åŒº(Pos): æ˜¾å­˜æ¶ˆè€—å‡å°‘4å€, é€šä¿¡é‡ä¸Žæ•°æ®å¹¶è¡Œç›¸åŒã€‚
1. æ–°å¢žæ¢¯åº¦åˆ†åŒº(Pos+g): æ˜¾å­˜æ¶ˆè€—å‡å°‘8å€, é€šä¿¡é‡ä¸Žæ•°æ®å¹¶è¡Œç›¸åŒã€‚
1. æ–°å¢žæ¨¡åž‹å‚æ•°åˆ†åŒº(Pos+g+p): æ¨¡åž‹å ç”¨çš„æ˜¾å­˜è¢«å¹³å‡åˆ†é…åˆ°æ¯ä¸ªGPUä¸­,  æ˜¾å­˜æ¶ˆè€—é‡ä¸Žæ•°æ®å¹¶è¡Œçš„å¹¶è¡Œåº¦æˆçº¿æ€§åæ¯”å…³ç³», ä½†é€šä¿¡é‡ä¼šæœ‰äº›è®¸å¢žåŠ ã€‚ä¾‹å¦‚ï¼Œåœ¨64ä¸ªGPUï¼ˆNd=64ï¼‰ä¹‹é—´è¿›è¡Œæ‹†åˆ†å°†äº§ç”Ÿ64å€çš„å†…å­˜ç¼©å‡ã€‚é€šä¿¡é‡æœ‰50%çš„é€‚åº¦å¢žé•¿ã€‚| è®­ç»ƒé€Ÿåº¦ä¼šä¸‹é™
> ðŸ’¡ ä¸ªäººæ€»ç»“

### ZeRO-Offload

æ ¸å¿ƒæ€æƒ³: æ˜¾å­˜ä¸è¶³ï¼Œå†…å­˜æ¥è¡¥ã€‚å°†éƒ¨åˆ†GPUçš„è®¡ç®—å’Œå­˜å‚¨ä¸‹æ”¾åˆ°CPUå’Œå†…å­˜ï¼Œå¿…ç„¶æ¶‰åŠCPUå’ŒGPUä¹‹é—´çš„é€šä¿¡å¢žåŠ ï¼Œä¸èƒ½è®©é€šä¿¡æˆä¸ºç“¶é¢ˆï¼Œæ­¤å¤–GPUçš„è®¡ç®—æ•ˆçŽ‡ç›¸æ¯”äºŽCPUä¹Ÿæ˜¯æ•°é‡çº§ä¸Šçš„ä¼˜åŠ¿ï¼Œä¹Ÿä¸èƒ½è®©CPUå‚ä¸Žè¿‡å¤šè®¡ç®—ï¼Œé¿å…æˆä¸ºç³»ç»Ÿç“¶é¢ˆï¼Œåªæœ‰å‰ä¸¤æ¡æ»¡è¶³çš„å‰æä¸‹ï¼Œå†è€ƒè™‘æœ€å°åŒ–æ˜¾å­˜çš„å ç”¨ã€‚

### ZeRO-Infinity

ZeRO-Offloadæ›´ä¾§é‡å•å¡åœºæ™¯ï¼Œè€ŒZeRO-Infinityåˆ™æ˜¯å…¸åž‹çš„å·¥ä¸šç•Œé£Žæ ¼ï¼Œå¥”ç€æžå¤§è§„æ¨¡è®­ç»ƒåŽ»äº†ã€‚

---

## DeepSpeedå®‰è£…

```bash
pip install deepspeed
```

- å®‰è£…åŽè¾“å…¥ds_reportéªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ
---

## DeepSpeedä½¿ç”¨

DeepSpeed åŠŸèƒ½å¯ä»¥é€šè¿‡æŒ‡å®šä¸ºÂ args.deepspeed_configÂ çš„é…ç½® JSON æ–‡ä»¶å¯ç”¨ã€ç¦ç”¨æˆ–é…ç½®ã€‚ä¸‹é¢å±•ç¤ºäº†ç¤ºä¾‹é…ç½®æ–‡ä»¶ã€‚

---

## Example

### ä»£ç å¯¹æ¯”ä¼ ç»Ÿä¸ŽDeepSpeedçš„ä¸»è¦åŒºåˆ«

1. DeepSpeed åˆå§‹åŒ–ï¼š
1. ZeRO-2 é…ç½®ï¼š
1. è®­ç»ƒå¾ªçŽ¯ï¼š
1. è®¾å¤‡ç®¡ç†ï¼š
---

> Reference











